<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Sort: Insertion Sort</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/vfa.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://coq-zh.github.io/SF-zh/'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 3: 函数式算法验证</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>目录</a></li>
   <li class='section_name'><a href='coqindex.html'>索引</a></li>
   <li class='section_name'><a href='deps.html'>路线</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Sort<span class="subtitle">Insertion Sort</span></h1>

<div class="code">
</div>

<div class="doc">

<div class="paragraph"> </div>

 Sorting can be done in O(N log N) time by various
    algorithms (quicksort, mergesort, heapsort, etc.).  But for
    smallish inputs, a simple quadratic-time algorithm such as
    insertion sort can actually be faster.  And it's certainly easier
    to implement -- and to prove correct. 
<div class="paragraph"> </div>

<a name="lab22"></a><h1 class="section">Recommended Reading</h1>

<div class="paragraph"> </div>

 If you don't already know how insertion sort works, see Wikipedia
    or read any standard textbook; for example:

<div class="paragraph"> </div>

   Sections 2.0 and 2.1 of <i>Algorithms, Fourth Edition</i>,
       by Sedgewick and Wayne, Addison Wesley 2011;  or

<div class="paragraph"> </div>

   Section 2.1 of <i>Introduction to Algorithms, 3rd Edition</i>,
       by Cormen, Leiserson, and Rivest, MIT Press 2009. 
</div>

<div class="doc">
<a name="lab23"></a><h1 class="section">The Insertion-Sort Program</h1>

<div class="paragraph"> </div>

 Insertion sort is usually presented as an imperative program
   operating on arrays.  But it works just as well as a functional
   program operating on linked lists! 
</div>
<div class="code">

<br/>
<span class="id" title="var">From</span> <span class="id" title="var">VFA</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Perm.html#"><span class="id" title="library">Perm</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <a name="insert"><span class="id" title="definition">insert</span></a> (<span class="id" title="var">i</span>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<span class="id" title="var">l</span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">h</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><span class="id" title="var">t</span> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#01f84f7b4db7ca25b5fbdf8f04a7bebc"><span class="id" title="notation">&lt;=?</span></a> <span class="id" title="var">h</span> <span class="id" title="keyword">then</span> <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><span class="id" title="var">h</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><span class="id" title="var">t</span> <span class="id" title="keyword">else</span> <span class="id" title="var">h</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a> <a class="idref" href="Sort.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">t</span><br/>
&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <a name="sort"><span class="id" title="definition">sort</span></a> (<span class="id" title="var">l</span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">h</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><span class="id" title="var">t</span> ⇒ <a class="idref" href="Sort.html#insert"><span class="id" title="definition">insert</span></a> <span class="id" title="var">h</span> (<a class="idref" href="Sort.html#sort"><span class="id" title="definition">sort</span></a> <span class="id" title="var">t</span>)<br/>
<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a name="sort_pi"><span class="id" title="definition">sort_pi</span></a>: <a class="idref" href="Sort.html#sort"><span class="id" title="definition">sort</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">[</span></a>3<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>4<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>9<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>6<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>3<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">]</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">[</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>3<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>3<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>4<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>6<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a>9<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">]</span></a>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
What Sedgewick/Wayne and Cormen/Leiserson/Rivest don't acknowlege
    is that the arrays-and-swaps model of sorting is not the only one
    in the world.  We are writing <i>functional programs</i>, where our
    sequences are (typically) represented as linked lists, and where
    we do <i>not</i> destructively splice elements into those lists.
    Instead, we build new lists that (sometimes) share structure with
    the old ones.

<div class="paragraph"> </div>

    So, for example: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <a class="idref" href="Sort.html#insert"><span class="id" title="definition">insert</span></a> 7 <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">[</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a> 3<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a> 4<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a> 8<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a> 12<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a> 14<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">;</span></a> 18<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#f83abbde7679bdbfec6afddd39d41e<sub>15</sub>"><span class="id" title="notation">]</span></a>.<br/>
<span class="comment">(*&nbsp;=&nbsp;<span class="inlinecode">1;</span> <span class="inlinecode">3;</span> <span class="inlinecode">4;</span> <span class="inlinecode">7;</span> <span class="inlinecode">8;</span> <span class="inlinecode">12;</span> <span class="inlinecode">14;</span> <span class="inlinecode">18</span>&nbsp;*)</span><br/>
</div>

<div class="doc">
The tail of this list, <span class="inlinecode">12::14::18::<span class="id" title="var">nil</span></span>, is not disturbed or
   rebuilt by the <span class="inlinecode"><span class="id" title="var">insert</span></span> algorithm.  The nodes <span class="inlinecode">1::3::4::7::<span class="id" title="var">_</span></span> are
   new, constructed by <span class="inlinecode"><span class="id" title="var">insert</span></span>.  The first three nodes of the old
   list, <span class="inlinecode">1::3::4::<span class="id" title="var">_</span></span> will likely be garbage-collected, if no other
   data structure is still pointing at them.  Thus, in this typical
   case,
<ul class="doclist">
<li> Time cost = 4X

</li>
<li> Space cost = (4-3)Y = Y

</li>
</ul>

<div class="paragraph"> </div>

   where X and Y are constants, independent of the length of the tail.
   The value Y is the number of bytes in one list node: 2 to 4 words,
   depending on how the implementation handles constructor-tags.
   We write (4-3) to indicate that four list nodes are constructed,
   while three list nodes become eligible for garbage collection.  

<div class="paragraph"> </div>

   We will not <i>prove</i> such things about the time and space cost, but
   they are <i>true</i> anyway, and we should keep them in
   consideration. 
</div>

<div class="doc">
<a name="lab24"></a><h1 class="section">Specification of Correctness</h1>

<div class="paragraph"> </div>

 A sorting algorithm must rearrange the elements into a list that
    is totally ordered. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="sorted"><span class="id" title="inductive">sorted</span></a>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> := <br/>
| <a name="sorted_nil"><span class="id" title="constructor">sorted_nil</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a><br/>
| <a name="sorted_1"><span class="id" title="constructor">sorted_1</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Sort.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nil"><span class="id" title="constructor">nil</span></a>)<br/>
| <a name="sorted_cons"><span class="id" title="constructor">sorted_cons</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Sort.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="Sort.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Sort.html#y"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Sort.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><a class="idref" href="Sort.html#y"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
</div>

<div class="doc">
Is this really the right definition of what it means for a list to
    be sorted?  One might have thought that it should go more like this: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="sorted'"><span class="id" title="definition">sorted'</span></a> (<span class="id" title="var">al</span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>, <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#432e31800fc09abd260feb634dbbd1af"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="Sort.html#j"><span class="id" title="variable">j</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#432e31800fc09abd260feb634dbbd1af"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">≤</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="Sort.html#j"><span class="id" title="variable">j</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> 0.<br/>
</div>

<div class="doc">
This is a reasonable definition too.  It should be equivalent.
    Later on, we'll prove that the two definitions really are
    equivalent.  For now, let's use the first one to define what it
    means to be a correct sorting algorthm. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="is_a_sorting_algorithm"><span class="id" title="definition">is_a_sorting_algorithm</span></a> (<span class="id" title="var">f</span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">al</span>, <a class="idref" href="http://coq.inria.fr/library//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> (<a class="idref" href="Sort.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Sort.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a>).<br/>
</div>

<div class="doc">
The result <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">al</span>)</span> should not only be a <span class="inlinecode"><span class="id" title="var">sorted</span></span> sequence,
    but it should be some rearrangement (Permutation) of the input sequence. 
</div>
<div class="code">
</div>

<div class="doc">
<a name="lab25"></a><h1 class="section">Proof of Correctness</h1>

<div class="paragraph"> </div>

<a name="lab26"></a><h4 class="section">练习：3 星, standard (insert_perm)</h4>
 Prove the following auxiliary lemma, <span class="inlinecode"><span class="id" title="var">insert_perm</span></span>, which will be
    useful for proving <span class="inlinecode"><span class="id" title="var">sort_perm</span></span> below.  Your proof will be by
    induction, but you'll need some of the permutation facts from the
    library, so first remind yourself by doing <span class="inlinecode"><span class="id" title="keyword">Search</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Search</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="insert_perm"><span class="id" title="lemma">insert_perm</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/library//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> (<a class="idref" href="Sort.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#0a8150c3c4df34d205c5ed9a427e2ed<sub>5</sub>"><span class="id" title="notation">::</span></a><a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>) (<a class="idref" href="Sort.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="Sort.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab27"></a><h4 class="section">练习：3 星, standard (sort_perm)</h4>
 Now prove that sort is a permutation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="sort_perm"><span class="id" title="lemma">sort_perm</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="http://coq.inria.fr/library//Coq.Sorting.Permutation.html#Permutation"><span class="id" title="inductive">Permutation</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a> (<a class="idref" href="Sort.html#sort"><span class="id" title="definition">sort</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab28"></a><h4 class="section">练习：4 星, standard (insert_sorted)</h4>
 This one is a bit tricky.  However, there just a single induction
   right at the beginning, and you do <i>not</i> need to use <span class="inlinecode"><span class="id" title="var">insert_perm</span></span>
   or <span class="inlinecode"><span class="id" title="var">sort_perm</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="insert_sorted"><span class="id" title="lemma">insert_sorted</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>, <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Sort.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="Sort.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab29"></a><h4 class="section">练习：2 星, standard (sort_sorted)</h4>
 This one is easy.   
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="sort_sorted"><span class="id" title="lemma">sort_sorted</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> (<a class="idref" href="Sort.html#sort"><span class="id" title="definition">sort</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 Now we wrap it all up.  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="insertion_sort_correct"><span class="id" title="lemma">insertion_sort_correct</span></a>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Sort.html#is_a_sorting_algorithm"><span class="id" title="definition">is_a_sorting_algorithm</span></a> <a class="idref" href="Sort.html#sort"><span class="id" title="definition">sort</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Sort.html#sort_perm"><span class="id" title="axiom">sort_perm</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="Sort.html#sort_sorted"><span class="id" title="axiom">sort_sorted</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a name="lab30"></a><h1 class="section">Making Sure the Specification is Right</h1>

<div class="paragraph"> </div>

 It's really important to get the <i>specification</i> right.  You can
    prove that your program satisfies its specification (and Coq will
    check that proof for you), but you can't prove that you have the
    right specification.  Therefore, we take the trouble to write two
    different specifications of sortedness (<span class="inlinecode"><span class="id" title="var">sorted</span></span> and <span class="inlinecode"><span class="id" title="var">sorted'</span></span>),
    and prove that they mean the same thing.  This increases our
    confidence that we have the right specification, though of course
    it doesn't <i>prove</i> that we do. 
<div class="paragraph"> </div>

<a name="lab31"></a><h4 class="section">练习：4 星, standard, optional (sorted_sorted')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="sorted_sorted'"><span class="id" title="lemma">sorted_sorted'</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">al</span>, <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted'"><span class="id" title="definition">sorted'</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a>.<br/>
</div>

<div class="doc">
Hint: Instead of doing induction on the list <span class="inlinecode"><span class="id" title="var">al</span></span>, do induction
    on the <i>sortedness</i> of <span class="inlinecode"><span class="id" title="var">al</span></span>. This proof is a bit tricky, so
    you may have to think about how to approach it, and try out
    one or two different ideas.
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab32"></a><h4 class="section">练习：3 星, standard, optional (sorted'_sorted)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="sorted'_sorted"><span class="id" title="lemma">sorted'_sorted</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">al</span>, <a class="idref" href="Sort.html#sorted'"><span class="id" title="definition">sorted'</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted"><span class="id" title="inductive">sorted</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a>.<br/>
</div>

<div class="doc">
Here, you can't do induction on the sorted'-ness of the list,
    because <span class="inlinecode"><span class="id" title="var">sorted'</span></span> is not an inductive predicate. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab33"></a><h1 class="section">Proving Correctness from the Alternate Spec</h1>

<div class="paragraph"> </div>

 Depending on how you write the specification of a program, it can
    be <i>much</i> harder or easier to prove correctness.  We saw that the
    predicates <span class="inlinecode"><span class="id" title="var">sorted</span></span> and <span class="inlinecode"><span class="id" title="var">sorted'</span></span> are equivalent; but it is really
    difficult to prove correctness of insertion sort directly from
    <span class="inlinecode"><span class="id" title="var">sorted'</span></span>.

<div class="paragraph"> </div>

    Try it yourself, if you dare!  I managed it, but my proof is quite
    long and complicated.  I found that I needed all these facts:
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">insert_perm</span></span>, <span class="inlinecode"><span class="id" title="var">sort_perm</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">Forall_perm</span></span>, <span class="inlinecode"><span class="id" title="var">Permutation_length</span></span>

</li>
<li> <span class="inlinecode"><span class="id" title="var">Permutation_sym</span></span>, <span class="inlinecode"><span class="id" title="var">Permutation_trans</span></span>

</li>
<li> a new lemma <span class="inlinecode"><span class="id" title="var">Forall_nth</span></span>, stated below.

</li>
</ul>

<div class="paragraph"> </div>

    Maybe you will find a better way that's not so complicated.

<div class="paragraph"> </div>

    DO NOT USE <span class="inlinecode"><span class="id" title="var">sorted_sorted'</span></span>, <span class="inlinecode"><span class="id" title="var">sorted'_sorted</span></span>, <span class="inlinecode"><span class="id" title="var">insert_sorted</span></span>, or
    <span class="inlinecode"><span class="id" title="var">sort_sorted</span></span> in these proofs! 
<div class="paragraph"> </div>

<a name="lab34"></a><h4 class="section">练习：3 星, standard, optional (Forall_nth)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="Forall_nth"><span class="id" title="lemma">Forall_nth</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span>: <span class="id" title="keyword">Type</span>} (<span class="id" title="var">P</span>: <a class="idref" href="Sort.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span>) <span class="id" title="var">d</span> (<span class="id" title="var">al</span>: <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="Sort.html#A"><span class="id" title="variable">A</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> <a class="idref" href="Sort.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#df1ced36fc33ce188051218bca314374"><span class="id" title="notation">↔</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#df1ced36fc33ce188051218bca314374"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <span class="id" title="var">i</span>,  <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#989c98e7ddd65d5bf37c334ff2076de<sub>8</sub>"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#length"><span class="id" title="definition">length</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#P"><span class="id" title="variable">P</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Lists.List.html#nth"><span class="id" title="definition">nth</span></a> <a class="idref" href="Sort.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Sort.html#al"><span class="id" title="variable">al</span></a> <a class="idref" href="Sort.html#d"><span class="id" title="variable">d</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#df1ced36fc33ce188051218bca314374"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab35"></a><h4 class="section">练习：4 星, standard, optional (insert_sorted')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="insert_sorted'"><span class="id" title="lemma">insert_sorted'</span></a>:<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>, <a class="idref" href="Sort.html#sorted'"><span class="id" title="definition">sorted'</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Sort.html#sorted'"><span class="id" title="definition">sorted'</span></a> (<a class="idref" href="Sort.html#insert"><span class="id" title="definition">insert</span></a> <a class="idref" href="Sort.html#a"><span class="id" title="variable">a</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab36"></a><h4 class="section">练习：4 星, standard, optional (insert_sorted')</h4>

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <a name="sort_sorted'"><span class="id" title="lemma">sort_sorted'</span></a>: <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <a class="idref" href="Sort.html#sorted'"><span class="id" title="definition">sorted'</span></a> (<a class="idref" href="Sort.html#sort"><span class="id" title="definition">sort</span></a> <a class="idref" href="Sort.html#l"><span class="id" title="variable">l</span></a>).<br/>
<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a name="lab37"></a><h2 class="section">The Moral of This Story</h2>

<div class="paragraph"> </div>

 The proofs of <span class="inlinecode"><span class="id" title="var">insert_sorted</span></span> and <span class="inlinecode"><span class="id" title="var">sort_sorted</span></span> were easy; the
    proofs of <span class="inlinecode"><span class="id" title="var">insert_sorted'</span></span> and <span class="inlinecode"><span class="id" title="var">sort_sorted'</span></span> were difficult; and
    yet <span class="inlinecode"><span class="id" title="var">sorted</span></span> <span class="inlinecode"><span class="id" title="var">al</span></span> <span class="inlinecode">↔</span> <span class="inlinecode"><span class="id" title="var">sorted'</span></span> <span class="inlinecode"><span class="id" title="var">al</span></span>.  <i>Different formulations of the
    functional specification can lead to great differences in the
    difficulty of the correctness proofs</i>.

<div class="paragraph"> </div>

   Suppose someone required you to prove <span class="inlinecode"><span class="id" title="var">sort_sorted'</span></span>, and never
   mentioned the <span class="inlinecode"><span class="id" title="var">sorted</span></span> predicate to you.  Instead of proving
   <span class="inlinecode"><span class="id" title="var">sort_sorted'</span></span> directly, it would be much easier to design a new
   predicate (<span class="inlinecode"><span class="id" title="var">sorted</span></span>), and then prove <span class="inlinecode"><span class="id" title="var">sort_sorted</span></span> and
   <span class="inlinecode"><span class="id" title="var">sorted_sorted'</span></span>. 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;2020年1月20日&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>